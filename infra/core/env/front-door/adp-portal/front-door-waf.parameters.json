{
  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentParameters.json#",
  "contentVersion": "1.0.0.0",
  "parameters": {
    "wafPolicyName": {
      "value": "#{{ adpPortalwafPolicyName }}"
    },
    "policySettings": {
      "value": {
        "enabledState": "Enabled",
        "mode": "Prevention"
      }
    },
    "purpose": {
      "value": "ADP Core ADP Portal Front Door WAF - All Services Generic"
    },
    "environment": {
      "value": "#{{ environment }}"
    },
    "customBlockResponseBody": {
      "value": "<html lang=\"en\"><head><meta charset=\"utf-8\"><meta name=\"viewport\" content=\"width=device-width,initial-scale=1\"><meta name=\"theme-color\" content=\"#000000\"><link rel=\"icon\" href=\"/favicon.ico\"><link rel=\"shortcut icon\" href=\"/favicon.ico\"><link rel=\"apple-touch-icon\" sizes=\"180x180\" href=\"/apple-touch-icon.png\"><link rel=\"icon\" type=\"image/png\" sizes=\"32x32\" href=\"/favicon-32x32.png\"><link rel=\"icon\" type=\"image/png\" sizes=\"16x16\" href=\"/favicon-16x16.png\"><link rel=\"mask-icon\" href=\"/safari-pinned-tab.svg\" color=\"#5bbad5\"><title>ADP Portal | Backstage</title><style>:root{--govuk-frontend-version:\"4.7.0\"}@font-face{font-family:\"GDS Transport\";src:url(\"/static/light-94a07e06a1-v2.bb962e0c1aef34ea7e4a.woff2\") format(\"woff2\"),url(\"/static/light-f591b13f7d-v2.f03d82c283b021916f42.woff\") format(\"woff\");font-style:normal;font-weight:400;font-display:fallback}@font-face{font-family:\"GDS Transport\";src:url(\"/static/bold-b542beb274-v2.616e5f212d1bb513477e.woff2\") format(\"woff2\"),url(\"/static/bold-affa96571d-v2.b092ddd69e01e5fb0b66.woff\") format(\"woff\");font-style:normal;font-weight:700;font-display:fallback}@font-face{font-family:\"GDS Transport\";src:url(\"/static/light-94a07e06a1-v2.bb962e0c1aef34ea7e4a.woff2\") format(\"woff2\"),url(\"/static/light-f591b13f7d-v2.f03d82c283b021916f42.woff\") format(\"woff\");font-style:normal;font-weight:400}.MuiPaper-root{color:rgba(0,0,0,.87);transition:box-shadow .3s cubic-bezier(.4, 0, .2, 1);background-color:#fff;background-image:unset}@media (prefers-color-scheme:dark){.MuiPaper-root{color:#fff;background-color:#222}}.MuiPaper-elevation0{box-shadow:none}.MuiTypography-root{margin:0}.MuiTypography-body1{font-size:1rem;font-family:\"GDS Transport\",arial,sans-serif;font-weight:400;line-height:1.5}.MuiTypography-h1{font-size:54px;font-family:\"GDS Transport\",arial,sans-serif;font-weight:700;line-height:1.167;margin-bottom:10px}.MuiTypography-gutterBottom{margin-bottom:.35em}.MuiSvgIcon-root{fill:currentcolor;width:1em;height:1em;display:inline-block;font-size:1.5rem;transition:fill .2s cubic-bezier(.4, 0, .2, 1);flex-shrink:0;user-select:none}.MuiSvgIcon-fontSizeInherit{font-size:inherit}.MuiAlert-root{display:flex;padding:6px 16px;font-size:.875rem;font-family:\"GDS Transport\",arial,sans-serif;font-weight:400;line-height:1.43;border-radius:4px;background-color:transparent}.MuiAlert-standardError{background-color:#fdecea}@media (prefers-color-scheme:dark){.MuiAlert-standardError{background-color:#180605}}.MuiAlert-standardError .MuiAlert-icon{color:#f44336}.MuiAlert-icon{display:flex;opacity:.9;padding:7px 0;font-size:22px;margin-right:12px}.MuiAlert-message{padding:8px 0}.MuiGrid-container{width:100%;display:flex;flex-wrap:wrap;box-sizing:border-box}.MuiGrid-spacing-xs-4{width:calc(100% + 32px);margin:-16px}html{height:100%;box-sizing:border-box;font-family:\"GDS Transport\",arial,sans-serif}*,::after,::before{box-sizing:inherit}b,strong{font-weight:700}body{color:rgba(0,0,0,.87);height:100%;margin:0;font-size:.875rem;font-family:\"GDS Transport\",arial,sans-serif;font-weight:400;line-height:1.43;background-color:#f8f8f8;overscroll-behavior-y:none}@media (prefers-color-scheme:dark){body{color:#fff;background-color:#313131}}@media print{body{background-color:#fff}}.BackstageContent-root{grid-area:pageContent;min-width:0;padding:24px 16px}@media (min-width:600px){.BackstageContent-root{padding-left:24px;padding-right:24px}}.BackstageHeader-header{width:100%;display:flex;padding:24px;z-index:100;position:relative;grid-area:pageHeader;box-shadow:rgba(0,0,0,.2) 0 2px 4px -1px,rgba(0,0,0,.14) 0 4px 5px 0,rgba(0,0,0,.12) 0 1px 10px 0;align-items:center;border-bottom:4px solid #1d70b8;flex-direction:row;background-size:cover;background-image:none,linear-gradient(90deg,#171717,#171717);background-position:center center}@media (max-width:959.95px){.BackstageHeader-header{flex-wrap:wrap}}.BackstageHeader-leftItemsBox{flex-grow:1;max-width:100%}.BackstageHeader-rightItemsBox{width:auto;align-items:center}.BackstageHeader-title{color:#fff;font-size:32px;word-break:break-word;margin-bottom:0}.BackstagePage-root{height:100vh;display:grid;overflow-y:auto;grid-template:\"pageHeader pageHeader pageHeader\" max-content \"pageSubheader pageSubheader pageSubheader\" \"pageNav pageContent pageSidebar\" 1fr/auto 1fr auto}@media (max-width:599.95px){.BackstagePage-root{height:100%}}@media print{.BackstagePage-root{height:auto;display:block;overflow-y:inherit}}.MuiAlertTitle-root{margin-top:-2px;font-weight:500}</style></head><body><div id=\"root\"><main class=\"BackstagePage-root\"><header class=\"BackstageHeader-header\"><div class=\"BackstageHeader-leftItemsBox\"><h1 class=\"MuiTypography-root BackstageHeader-title MuiTypography-h1\" tabindex=\"-1\">ADP Portal</h1></div><div class=\"MuiGrid-root BackstageHeader-rightItemsBox MuiGrid-container MuiGrid-spacing-xs-4\"></div></header><article class=\"BackstageContent-root\"><div class=\"MuiPaper-root MuiAlert-root MuiAlert-standardError MuiPaper-elevation0\" role=\"alert\"><div class=\"MuiAlert-icon\"><svg class=\"MuiSvgIcon-root MuiSvgIcon-fontSizeInherit\" focusable=\"false\" viewBox=\"0 0 24 24\" aria-hidden=\"true\"><path d=\"M11 15h2v2h-2zm0-8h2v6h-2zm.99-5C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2zM12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8z\"></path></svg></div><div class=\"MuiAlert-message\"><div class=\"MuiTypography-root MuiAlertTitle-root MuiTypography-body1 MuiTypography-gutterBottom\">Unfortunately, there is a problem with your request</div><p><b>Your request has been blocked.</b> Please contact the site administrator or the Defra helpdesk with the following information.</p><p><b>Tracking Request ID</b>: {{azure-ref}}</p></div></div></article></main></div></body></html>"
    },
    "deployWAF": {
      "value": "#{{ deployAdpPortalWAF }}"
    },
    "managedRuleSets": {
      "value": [
        {
          "ruleSetType": "Microsoft_DefaultRuleSet",
          "ruleSetVersion": "2.1",
          "ruleSetAction": "Block",
          "ruleGroupOverrides": [
            {
              "ruleGroupName": "RFI",
              "rules": [
                {
                  "ruleId": "931130",
                  "enabledState": "Enabled",
                  "action": "AnomalyScoring",
                  "exclusions": [
                    {
                      "matchVariable": "RequestBodyJsonArgNames",
                      "selectorMatchOperator": "Contains",
                      "selector": "entity.metadata.annotations"
                    },
                    {
                        "matchVariable": "RequestBodyJsonArgNames",
                        "selectorMatchOperator": "Contains",
                        "selector": "entity.metadata.links.url"
                    },
                    {
                        "matchVariable": "RequestBodyJsonArgNames",
                        "selectorMatchOperator": "Contains",
                        "selector": "entity.metadata.annotations.backstage"
                    },
                    {
                        "matchVariable": "RequestBodyJsonArgNames",
                        "selectorMatchOperator": "Contains",
                        "selector": "url"
                    }
                  ]
                }
              ],
              "exclusions": []
            },
            {
              "ruleGroupName": "MS-ThreatIntel-SQLI",
              "rules": [
                {
                  "ruleId": "99031001",
                  "enabledState": "Enabled",
                  "action": "AnomalyScoring",
                  "exclusions": [
                    {
                      "matchVariable": "RequestBodyJsonArgNames",
                      "selectorMatchOperator": "Contains",
                      "selector": "entity.metadata.annotations"
                    }
                  ]
                }
              ],
              "exclusions": []
            },
            {
              "ruleGroupName": "PROTOCOL-ENFORCEMENT",
              "rules": [
                {
                  "ruleId": "920440",
                  "enabledState": "Disabled",
                  "action": "AnomalyScoring",
                  "exclusions": []
                }
              ],
              "exclusions": []
            },
            {
              "ruleGroupName": "LFI",
              "rules": [
                {
                  "ruleId": "930130",
                  "enabledState": "Disabled",
                  "action": "AnomalyScoring",
                  "exclusions": []
                },
                {
                  "ruleId": "930120",
                  "enabledState": "Enabled",
                  "action": "AnomalyScoring",
                  "exclusions": [
                      {
                          "matchVariable": "QueryStringArgNames",
                          "selectorMatchOperator": "Contains",
                          "selector": "fields"
                      }
                  ]
                }
              ],
              "exclusions": []
            },
            {
              "ruleGroupName": "PHP",
              "rules": [
                {
                  "ruleId": "933210",
                  "enabledState": "Disabled",
                  "action": "AnomalyScoring",
                  "exclusions": [
                    {
                      "matchVariable": "RequestBodyJsonArgNames",
                      "selectorMatchOperator": "Contains",
                      "selector": "entity.metadata.annotations"
                    }
                  ]
                }
              ],
              "exclusions": []
            }                     
          ],
          "exclusions": []
        },
        {
          "ruleSetType": "Microsoft_BotManagerRuleSet",
          "ruleSetVersion": "1.0",
          "ruleGroupOverrides": [],
          "exclusions": []
        }
      ]
    },
    "defraApprovedIPcustomRule": {
      "value": [
        {
          "name": "AllowDefraApprovedIPRule",
          "enabledState": "Enabled",
          "priority": 300,
          "ruleType": "MatchRule",
          "matchConditions": [
            {
              "matchVariable": "RemoteAddr",
              "selector": null,
              "operator": "IPMatch",
              "negateCondition": true,
              "matchValue": #{{ noescape(customRule_DefraApprovedIp) }},
              "transforms": []
            }
          ],
          "action": "Block"
        }
      ]
    },
    "customRules": {
      "value": [       
      ]
    }
  }
}